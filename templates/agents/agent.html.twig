{% extends 'base.html.twig' %}

{% block title %}Hello ManagerController!{% endblock %}

{% block body %}
    <p>Agent Name : {{ agentName.firstname }} {{ agentName.lastname }}</p>
    <h1> Unclaimed Tickets</h1>
    <table>
        <tr>
            <th>Priority</th>
            <th>Status</th>
            <th>Title</th>
            <th>Made</th>
            <th>Claim</th>
            <th>History</th>
        </tr>
        {% for ticket in allMadeTickets  %}
            {%  if  agentName.getRoles() == ["ROLE_AGENT_TWO"] %}
                {% if ticket.priority == 2 %}
                    <tr>
                        <td>{{ ticket.priority }}</td>
                        <td>{{ ticket.status }}</td>
                        <td>{{ ticket.title }}</td>
                        <td>{{ ticket.time|date("m-d H:i") }}</td>
                        <td><form method="post"><button value="{{ ticket.id }}" name="claimed" type="submit">Claim</button></form></td>
                        <td><button><a href="/index.php/comment/{{ ticket.id }}">History</a></button></td>
                        <td><form method="post"><button type="submit" name="closeTicket" value="{{ ticket.id }}">Close Ticket</button></form></td>
                    </tr>
                {% endif %}
            {% endif %}
            {%  if  agentName.getRoles() == ["ROLE_AGENT"] %}
                {% if ticket.priority == 1 %}
                    <tr>
                        <td>{{ ticket.priority }}</td>
                        <td>{{ ticket.status }}</td>
                        <td>{{ ticket.title }}</td>
                        <td>{{ ticket.time|date("m-d H:i") }}</td>
                        <td><form method="post"><button value="{{ ticket.id }}" name="claimed" type="submit">Claim</button></form></td>
                        <td><button><a href="/index.php/comment/{{ ticket.id }}">History</a></button></td>
                        <td><form method="post"><button type="submit" name="closeTicket" value="{{ ticket.id }}">Close Ticket</button></form></td>
                    </tr>
                {% endif %}
            {% endif %}
        {% endfor %}
    </table>
<h1>In Progress</h1>
    <table>
        <tr>
            <th>Priority</th>
            <th>Status</th>
            <th>Title</th>
            <th>Made</th>
            <th>History</th>
        </tr>
        {%  for ticket in claimed %}
            {%  if  agentName.getRoles() == ["ROLE_AGENT_TWO"] %}
                {% if ticket.priority == 2 %}
                    <tr>
                        <td>{{ ticket.priority }}</td>
                        <td>{{ ticket.status }}</td>
                        <td>{{ ticket.title }}</td>
                        <td>{{ ticket.time|date("m-d H:i") }}</td>
                        <td><button><a href="/index.php/comment/{{ ticket.id }}">History</a></button></td>
                        <td><form method="post"><button type="submit" name="closeTicket" value="{{ ticket.id }}">Close Ticket</button></form></td>
                    </tr>
                {% endif %}
            {% endif %}
            {%  if  agentName.getRoles() == ["ROLE_AGENT"] %}
                {% if ticket.priority == 1 %}
                    <tr>
                        <td>{{ ticket.priority }}</td>
                        <td>{{ ticket.status }}</td>
                        <td>{{ ticket.title }}</td>
                        <td>{{ ticket.time|date("m-d H:i") }}</td>
                        <td><button><a href="/index.php/comment/{{ ticket.id }}">History</a></button></td>
                        <td><form method="post"><button value="{{ ticket.id }}" name="escalate" type="submit">Escalate</button></form></td>
                        <td><form method="post"><button type="submit" name="closeTicket" value="{{ ticket.id }}">Close Ticket</button></form></td>
                    </tr>
                {% endif %}
            {% endif %}
        {% endfor %}
    </table>

    <style>
        .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
        .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    </style>

    <p>
        <a href="{{ path('app_logout') }}">Logout</a>
    </p>
{% endblock %}
